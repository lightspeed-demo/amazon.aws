---
- name: Attempt to delete non-existent buckets
  block:
    - ansible.builtin.set_fact:
        local_bucket_name: "{{ bucket_name | hash('md5')}}-missing"
    # ============================================================
    #
    # While in theory the 'simple' test case covers this there are

    - name: Delete non-existstent s3_bucket (never created)
      register: output
      amazon.aws.s3_bucket:
        name: "{{ local_bucket_name }}"
        state: absent

    - assert:
        that:
          - output is success
          - output is not changed

    # ============================================================

    - name: Ensure all buckets are deleted
      ignore_errors: true
      amazon.aws.s3_bucket:
        name: "{{ local_bucket_name }}"
        state: absent
